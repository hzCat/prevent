import{y as oe,j as k,l as L,r as i,z as R,A as ne,d as N,c as y,T as Y,B as K,C as j,k as ae,n as se,i as le,D as ce,s as re,E as ie,F as ue,m as A,G as de,q as ve}from"./index-eveRkr_s.js";import{d as fe,o as me,e as T,n as S,t as C,u as F,T as E,c as M,s as ye,b as X,w as $,m as g,H as he,I as Ie}from"./index-Cns-baah.js";import{o as pe,h as Ce,p as H,e as G}from"./index-BAubkpgm.js";function Oe(e,{args:t=[],done:o,canceled:a,error:n}){if(e){const s=e.apply(null,t);fe(s)?s.then(l=>{l?o():a&&a()}).catch(n||me):s?o():a&&a()}else o()}const V=Symbol();function Ne(e){const t=oe(V,null);t&&k(t,o=>{o&&e()})}function U(e){const t=L();t&&T(t.proxy,e)}let Pe=2e3;const be=()=>++Pe,Z={show:Boolean,zIndex:S,overlay:C,duration:S,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:F,transitionAppear:Boolean,closeOnClickOverlay:C},Ye=Object.keys(Z);function we(e,t){return e>t?"horizontal":t>e?"vertical":""}function Se(){const e=i(0),t=i(0),o=i(0),a=i(0),n=i(0),s=i(0),l=i(""),r=i(!0),O=()=>l.value==="vertical",p=()=>l.value==="horizontal",u=()=>{o.value=0,a.value=0,n.value=0,s.value=0,l.value="",r.value=!0};return{move:d=>{const v=d.touches[0];o.value=(v.clientX<0?0:v.clientX)-e.value,a.value=v.clientY-t.value,n.value=Math.abs(o.value),s.value=Math.abs(a.value);const I=10;(!l.value||n.value<I&&s.value<I)&&(l.value=we(n.value,s.value)),r.value&&(n.value>E||s.value>E)&&(r.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:o,deltaY:a,offsetX:n,offsetY:s,direction:l,isVertical:O,isHorizontal:p,isTap:r}}let P=0;const D="van-overflow-hidden";function ke(e,t){const o=Se(),a="01",n="10",s=u=>{o.move(u);const h=o.deltaY.value>0?n:a,b=Ce(u.target,e.value),{scrollHeight:d,offsetHeight:v,scrollTop:I}=b;let f="11";I===0?f=v>=d?"00":"01":I+v>=d&&(f="10"),f!=="11"&&o.isVertical()&&!(parseInt(f,2)&parseInt(h,2))&&H(u,!0)},l=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",s,{passive:!1}),P||document.body.classList.add(D),P++},r=()=>{P&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",s),P--,P||document.body.classList.remove(D))},O=()=>t()&&l(),p=()=>t()&&r();pe(O),R(p),ne(p),k(t,u=>{u?l():r()})}function q(e){const t=i(!1);return k(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const _=()=>{var e;const{scopeId:t}=((e=L())==null?void 0:e.vnode)||{};return t?{[t]:""}:null},[Te,xe]=M("overlay"),ge={show:Boolean,zIndex:S,duration:S,className:F,lockScroll:C,lazyRender:C,customStyle:Object};var ze=N({name:Te,props:ge,setup(e,{slots:t}){const o=i(),a=q(()=>e.show||!e.lazyRender),n=l=>{e.lockScroll&&H(l,!0)},s=a(()=>{var l;const r=T(ye(e.zIndex),e.customStyle);return X(e.duration)&&(r.animationDuration=`${e.duration}s`),K(y("div",{ref:o,style:r,class:[xe(),e.className]},[(l=t.default)==null?void 0:l.call(t)]),[[j,e.show]])});return G("touchmove",n,{target:o}),()=>y(Y,{name:"van-fade",appear:!0},{default:s})}});const Ae=$(ze),Ee=T({},Z,{round:Boolean,position:g("center"),closeIcon:g("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:g("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[De,B]=M("popup");var _e=N({name:De,inheritAttrs:!1,props:Ee,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:a}){let n,s;const l=i(),r=i(),O=q(()=>e.show||!e.lazyRender),p=ae(()=>{const c={zIndex:l.value};if(X(e.duration)){const m=e.position==="center"?"animationDuration":"transitionDuration";c[m]=`${e.duration}s`}return c}),u=()=>{n||(n=!0,l.value=e.zIndex!==void 0?+e.zIndex:be(),t("open"))},h=()=>{n&&Oe(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},b=c=>{t("clickOverlay",c),e.closeOnClickOverlay&&h()},d=()=>{if(e.overlay)return y(Ae,A({show:e.show,class:e.overlayClass,zIndex:l.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},_(),{onClick:b}),{default:a["overlay-content"]})},v=c=>{t("clickCloseIcon",c),h()},I=()=>{if(e.closeable)return y(Ie,{role:"button",tabindex:0,name:e.closeIcon,class:[B("close-icon",e.closeIconPosition),he],classPrefix:e.iconPrefix,onClick:v},null)};let f;const W=()=>{f&&clearTimeout(f),f=setTimeout(()=>{t("opened")})},J=()=>t("closed"),Q=c=>t("keydown",c),ee=O(()=>{var c;const{round:m,position:w,safeAreaInsetTop:x,safeAreaInsetBottom:te}=e;return K(y("div",A({ref:r,style:p.value,role:"dialog",tabindex:0,class:[B({round:m,[w]:w}),{"van-safe-area-top":x,"van-safe-area-bottom":te}],onKeydown:Q},o,_()),[(c=a.default)==null?void 0:c.call(a),I()]),[[j,e.show]])}),z=()=>{const{position:c,transition:m,transitionAppear:w}=e,x=c==="center"?"van-fade":`van-popup-slide-${c}`;return y(Y,{name:m||x,appear:w,onAfterEnter:W,onAfterLeave:J},{default:ee})};return k(()=>e.show,c=>{c&&!n&&(u(),o.tabindex===0&&se(()=>{var m;(m=r.value)==null||m.focus()})),!c&&n&&(n=!1,t("close"))}),U({popupRef:r}),ke(r,()=>e.show&&e.lockScroll),G("popstate",()=>{e.closeOnPopstate&&(h(),s=!1)}),le(()=>{e.show&&u()}),ce(()=>{s&&(t("update:show",!0),s=!1)}),R(()=>{e.show&&e.teleport&&(h(),s=!0)}),re(V,()=>e.show),()=>e.teleport?y(ie,{to:e.teleport},{default:()=>[d(),z()]}):y(ue,null,[d(),z()])}});const Ke=$(_e);function je(){const e=ve({show:!1}),t=n=>{e.show=n},o=n=>{T(e,n,{transitionAppear:!0}),t(!0)},a=()=>t(!1);return U({open:o,close:a,toggle:t}),{open:o,close:a,state:e,toggle:t}}function Fe(e){const t=de(e),o=document.createElement("div");return document.body.appendChild(o),{instance:t.mount(o),unmount(){t.unmount(),document.body.removeChild(o)}}}export{Ke as P,U as a,_ as b,Ye as c,Oe as d,Fe as m,Ne as o,Z as p,je as u};
